<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Game Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .config-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .test-types {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e1e5e9;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }

        .status-info {
            margin-top: 10px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .status-info.running {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .status-info.completed {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }

        .status-info.failed {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .reports-section {
            margin-top: 30px;
        }

        .reports-list {
            display: grid;
            gap: 15px;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }

        .report-info {
            flex: 1;
        }

        .report-name {
            font-weight: 600;
            color: #333;
        }

        .report-meta {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            margin-left: 10px;
        }

        .game-preview {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .game-preview img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .config-section {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 Multi-Agent Game Tester</h1>
            <p>Automated testing for SumLink puzzle game using AI agents</p>
        </div>

        <div class="card">
            <h2>Game Configuration</h2>
            
            <div class="game-preview">
                <h3>Target Game: SumLink</h3>
                <p>Number matching puzzle game with drag-and-drop mechanics</p>
                <a href="https://play.ezygamers.com/" target="_blank">🎯 Open Game</a>
            </div>

            <div class="config-section">
                <div class="input-group">
                    <label for="gameUrl">Game URL</label>
                    <input type="url" id="gameUrl" value="https://play.ezygamers.com/" />
                </div>

                <div class="input-group">
                    <label for="numCandidates">Test Candidates to Generate</label>
                    <input type="number" id="numCandidates" value="20" min="10" max="50" />
                </div>

                <div class="input-group">
                    <label for="numExecute">Top Tests to Execute</label>
                    <input type="number" id="numExecute" value="10" min="5" max="25" />
                </div>

                <div class="input-group">
                    <label>Test Categories</label>
                    <div class="test-types">
                        <div class="checkbox-item">
                            <input type="checkbox" id="basic_gameplay" checked />
                            <label for="basic_gameplay">Basic Gameplay</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="edge_cases" checked />
                            <label for="edge_cases">Edge Cases</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="performance" checked />
                            <label for="performance">Performance</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ui_validation" checked />
                            <label for="ui_validation">UI Validation</label>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn" id="startTestBtn" onclick="startTest()">
                🚀 Start Multi-Agent Testing
            </button>
        </div>

        <div class="card" id="progressCard" style="display: none;">
            <h2>Test Progress</h2>
            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="status-info" id="statusInfo">
                    <strong>Status:</strong> <span id="statusText">Initializing...</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Test Reports</h2>
            <div class="reports-section">
                <button class="btn" onclick="refreshReports()">🔄 Refresh Reports</button>
                <div class="reports-list" id="reportsList">
                    <p>No reports available. Run a test to generate reports.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTestId = null;
        let statusInterval = null;

        async function startTest() {
            const startBtn = document.getElementById('startTestBtn');
            const progressCard = document.getElementById('progressCard');
            
            // Disable button and show progress
            startBtn.disabled = true;
            startBtn.textContent = '⏳ Starting Test...';
            progressCard.style.display = 'block';
            
            // Collect configuration
            const config = {
                game_url: document.getElementById('gameUrl').value,
                num_candidates: parseInt(document.getElementById('numCandidates').value),
                num_execute: parseInt(document.getElementById('numExecute').value),
                test_types: Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.id)
            };
            
            try {
                const response = await fetch('/api/start-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentTestId = result.test_run_id;
                    
                    // Start polling for status
                    statusInterval = setInterval(checkStatus, 2000);
                    
                } else {
                    throw new Error('Failed to start test');
                }
                
            } catch (error) {
                console.error('Error starting test:', error);
                updateStatus('Failed to start test: ' + error.message, 'failed', 0);
                resetButton();
            }
        }

        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                
                updateStatus(status.message, status.status, status.progress);
                
                if (status.status === 'completed' || status.status === 'failed') {
                    clearInterval(statusInterval);
                    resetButton();
                    
                    if (status.status === 'completed') {
                        setTimeout(refreshReports, 1000);
                    }
                }
                
            } catch (error) {
                console.error('Error checking status:', error);
                clearInterval(statusInterval);
                resetButton();
            }
        }

        function updateStatus(message, status, progress) {
            const progressFill = document.getElementById('progressFill');
            const statusInfo = document.getElementById('statusInfo');
            const statusText = document.getElementById('statusText');
            
            progressFill.style.width = progress + '%';
            statusText.textContent = message;
            
            statusInfo.className = `status-info ${status}`;
        }

        function resetButton() {
            const startBtn = document.getElementById('startTestBtn');
            startBtn.disabled = false;
            startBtn.textContent = '🚀 Start Multi-Agent Testing';
        }

        async function refreshReports() {
            try {
                const response = await fetch('/api/reports');
                const data = await response.json();
                
                const reportsList = document.getElementById('reportsList');
                
                if (data.reports.length === 0) {
                    reportsList.innerHTML = '<p>No reports available. Run a test to generate reports.</p>';
                    return;
                }
                
                reportsList.innerHTML = data.reports.map(report => `
                    <div class="report-item">
                        <div class="report-info">
                            <div class="report-name">${report.name}</div>
                            <div class="report-meta">
                                Created: ${new Date(report.created).toLocaleString()} | 
                                Size: ${(report.size / 1024).toFixed(1)} KB
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-small" onclick="downloadReport('${report.name}')">
                                📥 Download
                            </button>
                            <button class="btn btn-small" onclick="viewReport('${report.name}')">
                                👁️ View
                            </button>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error refreshing reports:', error);
            }
        }

        async function downloadReport(reportName) {
            window.open(`/api/reports/${reportName}`, '_blank');
        }

        async function viewReport(reportName) {
            try {
                const response = await fetch(`/api/reports/${reportName}`);
                const report = await response.json();
                
                // Open a new window to display the report
                const newWindow = window.open('', '_blank');
                newWindow.document.write(`
                    <html>
                        <head>
                            <title>Test Report: ${reportName}</title>
                            <style>
                                body { font-family: monospace; margin: 20px; }
                                pre { background: #f5f5f5; padding: 15px; border-radius: 5px; }
                            </style>
                        </head>
                        <body>
                            <h1>Test Report: ${reportName}</h1>
                            <pre>${JSON.stringify(report, null, 2)}</pre>
                        </body>
                    </html>
                `);
                
            } catch (error) {
                console.error('Error viewing report:', error);
                alert('Failed to load report');
            }
        }

        // Load reports on page load
        document.addEventListener('DOMContentLoaded', refreshReports);
    </script>
</body>
</html>